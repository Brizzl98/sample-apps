search doc {
    document doc {

        field datestring type string {
            indexing: summary
        }

        field timestamp type long {
            indexing: summary|attribute
        }

        field id type int {
            indexing: summary|index
            match:word
        }

        field title type string {
            indexing: index | summary
            index: enable-bm25
            stemming: best
        }

        field abstract type string {
            indexing: index | summary
            index: enable-bm25
            stemming: best
            summary: dynamic
        }

        field body_text type string {
            indexing: index | summary
            index: enable-bm25
            stemming: best
            summary: dynamic
        }

        field title_embedding type tensor<float>(x[768]) {
            indexing: attribute
        }

        field abstract_embedding type tensor<float>(x[768]) {
            indexing: attribute
        }

        field body_embedding type tensor<float>(x[768]) {
            indexing: attribute
        }

    }

    document-summary minimal {
        summary id type int {}
    }

    fieldset default {
        fields: abstract
    }

    rank-profile default {
        first-phase {
            expression: nativeRank(abstract)
        }
    }

    rank-profile bm25 inherits default {
        first-phase {
            expression: bm25(abstract)
        }
    }

    rank-profile scibert inherits default {
        function dot_product() {
            expression: sum(query(vector)*attribute(abstract_embedding))
        }
        first-phase {
            expression: dot_product()
        }
        ignore-default-rank-features
        rank-features {
            rankingExpression(dot_product)
        }
    }

    rank-profile bm25_scibert inherits default {
        function dot_product() {
            expression: sum(query(vector)*attribute(abstract_embedding))
        }
        first-phase {
            expression: bm25(abstract) + dot_product()
        }
        ignore-default-rank-features
        rank-features {
            bm25(abstract)
            rankingExpression(dot_product)
        }
    }

    rank-profile collect_rank_features_embeddings inherits default {
        function dot_product() {
            expression: sum(query(vector)*attribute(abstract_embedding))
        }
        first-phase {
            expression: random
        }
        ignore-default-rank-features
        rank-features {
            bm25(abstract)
            rankingExpression(dot_product)
        }
    }
}
